-- 상품 별 오프라인 매출 구하기
-- https://school.programmers.co.kr/learn/courses/30/lessons/131533

--- DDL
CREATE TABLE PRODUCT (
    PRODUCT_ID INTEGER PRIMARY KEY,
    PRODUCT_CODE VARCHAR(8) NOT NULL,
    PRICE INTEGER NOT NULL
);

CREATE TABLE OFFLINE_SALE (
    OFFLINE_SALE_ID INTEGER PRIMARY KEY,
    PRODUCT_ID INTEGER NOT NULL,
    SALES_AMOUNT INTEGER NOT NULL,
    SALES_DATE DATE NOT NULL
);
---

--- DML(INSERT)
INSERT INTO PRODUCT(PRODUCT_ID, PRODUCT_CODE, PRICE)
VALUES(1, 'A1000011', 15000),
       (2, 'A1000045', 8000),
       (3, 'C3000002', 42000);

INSERT INTO OFFLINE_SALE (OFFLINE_SALE_ID, PRODUCT_ID, SALES_AMOUNT, SALES_DATE)
VALUES(1, 1, 2, '2022-02-21'),
       (2, 1, 2, '2022-03-02'),
       (3, 3, 3, '2022-05-01'),
       (4, 2, 1, '2022-05-24'),
       (5, 1, 2, '2022-07-14'),
       (6, 2, 1, '2022-09-22');
---

--- DML(SELECT)
SELECT A.PRODUCT_CODE, SUM(A.PRICE * B.SALES_AMOUNT) AS SALES
FROM PRODUCT AS A
INNER JOIN OFFLINE_SALE AS B
ON A.PRODUCT_ID = B.PRODUCT_ID
GROUP BY PRODUCT_CODE
ORDER BY SALES DESC , PRODUCT_CODE
---